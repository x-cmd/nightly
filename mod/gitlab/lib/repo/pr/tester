# shellcheck shell=sh
# shellcheck disable=SC2039,3043

___x_cmd_gitlab_repo_pr_testers(){
    param:scope     ___x_cmd_gitlab
    param:subcmd ___x_cmd_gitlab_repo_pr_testers                \
        add             "Add assignee"                      \
        del             "Del assignee"                      \
        reset           "Reset all assignee"                \
        test            "test pass"
    param:subcmd:try
    param:run

    ___x_cmd_gitlab_repo_pr_testers _param_help_doc
    gitlab_log warn "Subcmd Not Found."
    return 1
}

# https://gitee.com/api/swagger#/postV5ReposOwnerRepoPullsNumberTesters
___x_cmd_gitlab_repo_pr_testers_add(){
    param:scope     ___x_cmd_gitlab
    param:dsl       '
options:
    #1|--pr         "pr id"                     <>
    --testers       "testers username list. Format: <username>[,<username>]"    <>
'
    param:run

    ___parse_pr_init_owner_repo_and_pr
    ___x_cmd_gitlab_http post "/repos/${owner_repo}/pulls/$pr/testers" testers
}

# https://gitee.com/api/swagger#/deleteV5ReposOwnerRepoPullsNumberTesters
___x_cmd_gitlab_repo_pr_testers_del(){
    param:scope     ___x_cmd_gitlab
    param:dsl       '
options:
    #1|--pr         "pr id"                     <>:NatureNumber
    --testers       "testers username list. Format: <username>[,<username>]"    <>:UserName
'
    param:run

    ___parse_pr_init_owner_repo_and_pr
    ___x_cmd_gitlab_http delete "/repos/${owner_repo}/pulls/$pr/testers?testers=$testers"
}

# https://gitee.com/api/swagger#/patchV5ReposOwnerRepoPullsNumberTesters
___x_cmd_gitlab_repo_pr_testers_reset(){
    param:scope     ___x_cmd_gitlab
    param:dsl       '
options:
    #1|--pr         "pr id"                     <>:NatureNumber
    --reset_all     "reset all"                 <>:Bool="false"
'
    param:run

    ___parse_pr_init_owner_repo_and_pr

    ___x_cmd_gitlab_http patch "/repos/${owner_repo}/pulls/$pr/testers" reset_all
}

#
___x_cmd_gitlab_repo_pr_testers_test(){
    param:scope     ___x_cmd_gitlab
    param:dsl       '
options:
    #1|--pr         "pr id"                     <>:NatureNumber
    --force         "force"                     <>:Bool="false"
'
    param:run

    ___parse_pr_init_owner_repo_and_pr

    ___x_cmd_gitlab_http post "/repos/${owner_repo}/pulls/$pr/test" force
}


